{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$ref": "#/definitions/Plugin",
  "definitions": {
    "Plugin": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Plugin unique identifier (UUID)"
        },
        "user_id": {
          "type": "string",
          "description": "User ID that owns this personal plugin"
        },
        "last_updated": {
          "type": "string",
          "description": "ISO timestamp of last update"
        },
        "name": {
          "type": "string",
          "pattern": "^[A-Za-z0-9_-]+$",
          "description": "Alphanumeric, underscore, and dash only"
        },
        "displayName": {
          "type": "string",
          "description": "Human-readable display name for the plugin"
        },
        "type": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "endpoint": {
          "type": "string"
        },
        "auth": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["NoAuth", "key", "identity", "user", "servicePrincipal", "connection_string", "basic", "username_password"],
              "description": "Auth type must be 'key', 'user', 'identity', 'servicePrincipal', 'connection_string', 'basic', or 'username_password'"
            },
            "key": {
              "type": "string",
              "description": "The secret value for the plugin should be stored here, such as a SQL connection string, a password for a service principal or username/password combination"
            },
            "identity": {
              "type": "string",
              "description": "This could be the Id of an (managed) identity, a user name, or similar to pair with the key, in most situations"
            },
            "tenantId": {
              "type": "string",
              "description": "The Azure AD tenant ID used with Service Principal authentication"
            }
          },
          "additionalProperties": false,
          "allOf": [
            { "if": { "properties": { "type": { "const": "NoAuth" } } }, "then": { "required": ["type"] } },
            { "if": { "properties": { "type": { "const": "key" } } }, "then": { "required": ["type", "key"] } },
            { "if": { "properties": { "type": { "const": "identity" } } }, "then": { "required": ["type", "identity"] } },
            { "if": { "properties": { "type": { "const": "user" } } }, "then": { "required": ["type"] } },
            { "if": { "properties": { "type": { "const": "servicePrincipal" } } }, "then": { "required": ["type", "tenantId", "identity", "key"] } },
            { "if": { "properties": { "type": { "const": "connection_string" } } }, "then": { "required": ["type", "key"] } },
            { "if": { "properties": { "type": { "const": "basic" } } }, "then": { "required": ["type", "key", "identity"] } },
            { "if": { "properties": { "type": { "const": "username_password" } } }, "then": { "required": ["type", "key", "identity"] } },
            { "required": ["type"] }
          ]
        },
        "metadata": {
          "type": "object",
          "description": "Arbitrary metadata",
          "additionalProperties": true
        },
        "additionalFields": {
          "type": "object",
          "description": "Additional fields for plugin configuration based on plugin type. See plugin documentation for details. Any fields named __Secret (double underscore) will be stored in key vault if the feature is enabled.",
          "additionalProperties": true
        }
      },
      "required": ["name", "type", "description", "endpoint", "auth", "metadata", "additionalFields"],
      "title": "Plugin"
    }
  }
}
