openapi: 3.0.0
info:
  title: ServiceNow Incident Management API
  description: ServiceNow REST API for incident management operations - Optimized for Simple Chat integration
  version: 1.0.0
  contact:
    name: ServiceNow API Support
    url: https://developer.servicenow.com

servers:
  - url: https://YOUR-INSTANCE.service-now.com/api/now
    description: ServiceNow Developer Instance

security:
  - basicAuth: []

paths:
  /table/incident:
    get:
      operationId: queryIncidents
      summary: Query incidents with filters
      description: Retrieve incidents from ServiceNow based on query parameters and filters
      parameters:
        - name: sysparm_query
          in: query
          required: false
          schema:
            type: string
          description: |
            Encoded query string for filtering results. Examples:
            - Last 7 days: sys_created_onONLast 7 days@gs.daysAgoStart(7)
            - By priority: priority=1
            - By state: state=1 (1=New, 2=In Progress, 6=Resolved, 7=Closed)
            - Combined: priority=1^state=1^sys_created_onONLast 30 days@gs.daysAgoStart(30)
          example: "sys_created_onONLast 7 days@gs.daysAgoStart(7)"
        
        - name: sysparm_limit
          in: query
          required: false
          schema:
            type: integer
            default: 100
            maximum: 10000
          description: Maximum number of records to return
          example: 50
        
        - name: sysparm_offset
          in: query
          required: false
          schema:
            type: integer
            default: 0
          description: Number of records to skip for pagination
          example: 0
        
        - name: sysparm_fields
          in: query
          required: false
          schema:
            type: string
          description: Comma-separated list of fields to return
          example: "number,short_description,priority,state,assigned_to,sys_created_on,category"
        
        - name: sysparm_display_value
          in: query
          required: false
          schema:
            type: string
            enum: [true, false, all]
            default: "false"
          description: Return display values instead of actual values
          example: "true"

      responses:
        '200':
          description: List of incidents retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: array
                    items:
                      $ref: '#/components/schemas/Incident'
              example:
                result:
                  - number: "INC0000001"
                    short_description: "Email server not responding"
                    priority: "2"
                    state: "1"
                    sys_id: "abc123xyz"
                    sys_created_on: "2026-01-15 10:30:00"
        
        '401':
          description: Unauthorized - Invalid credentials
        '403':
          description: Forbidden - Insufficient permissions

    post:
      operationId: createIncident
      summary: Create a new incident
      description: Create a new incident in ServiceNow
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - short_description
              properties:
                short_description:
                  type: string
                  description: Brief summary of the incident
                  example: "Email server not responding for Finance team"
                
                description:
                  type: string
                  description: Detailed description of the incident
                  example: "Users in Finance department cannot access email server. Error message: Connection timeout."
                
                urgency:
                  type: string
                  enum: ["1", "2", "3"]
                  description: "Urgency level: 1=High, 2=Medium, 3=Low"
                  example: "1"
                
                priority:
                  type: string
                  enum: ["1", "2", "3", "4", "5"]
                  description: "Priority: 1=Critical, 2=High, 3=Moderate, 4=Low, 5=Planning"
                  example: "2"
                
                impact:
                  type: string
                  enum: ["1", "2", "3"]
                  description: "Impact: 1=High, 2=Medium, 3=Low"
                  example: "2"
                
                category:
                  type: string
                  description: Incident category
                  example: "Email"
                
                subcategory:
                  type: string
                  description: Incident subcategory
                  example: "Server"
                
                assignment_group:
                  type: string
                  description: Assignment group name or sys_id
                  example: "IT Support"
                
                assigned_to:
                  type: string
                  description: Assigned user name or sys_id
                  example: ""
                
                caller_id:
                  type: string
                  description: User reporting the incident (name or sys_id)
                  example: ""

      responses:
        '201':
          description: Incident created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    $ref: '#/components/schemas/Incident'
              example:
                result:
                  number: "INC0010025"
                  sys_id: "xyz789abc"
                  short_description: "Email server not responding for Finance team"
                  state: "1"
        
        '400':
          description: Bad request - Invalid input
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /table/incident/{sys_id}:
    get:
      operationId: getIncidentDetails
      summary: Get incident details by sys_id
      description: Retrieve details of a specific incident
      parameters:
        - name: sys_id
          in: path
          required: true
          schema:
            type: string
          description: The sys_id of the incident
          example: "abc123xyz789"
        
        - name: sysparm_fields
          in: query
          required: false
          schema:
            type: string
          description: Comma-separated list of fields to return
          example: "number,short_description,description,priority,state,assigned_to,sys_created_on,resolved_at,close_notes"
        
        - name: sysparm_display_value
          in: query
          required: false
          schema:
            type: string
            enum: [true, false, all]
            default: "false"
          description: Return display values

      responses:
        '200':
          description: Incident details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    $ref: '#/components/schemas/Incident'
        
        '404':
          description: Incident not found
        '401':
          description: Unauthorized

    put:
      operationId: updateIncident
      summary: Update an existing incident
      description: Update incident fields
      parameters:
        - name: sys_id
          in: path
          required: true
          schema:
            type: string
          description: The sys_id of the incident to update
          example: "abc123xyz789"

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                state:
                  type: string
                  description: "State: 1=New, 2=In Progress, 3=On Hold, 6=Resolved, 7=Closed, 8=Canceled"
                  example: "6"
                
                work_notes:
                  type: string
                  description: Work notes to add
                  example: "Issue resolved by restarting email service"
                
                close_notes:
                  type: string
                  description: Resolution notes (for closing)
                  example: "Email server restarted. Service restored."
                
                priority:
                  type: string
                  description: Updated priority
                  example: "3"
                
                assigned_to:
                  type: string
                  description: Reassign to user (name or sys_id)
                  example: ""

      responses:
        '200':
          description: Incident updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    $ref: '#/components/schemas/Incident'
        
        '400':
          description: Bad request
        '404':
          description: Incident not found
        '401':
          description: Unauthorized

  /stats/incident:
    get:
      operationId: getIncidentStats
      summary: Get incident statistics
      description: Retrieve aggregated statistics for incidents
      parameters:
        - name: sysparm_query
          in: query
          required: false
          schema:
            type: string
          description: Query filter for statistics
          example: "sys_created_onONLast 30 days@gs.daysAgoStart(30)"
        
        - name: sysparm_count
          in: query
          required: false
          schema:
            type: boolean
            default: true
          description: Include count in results
        
        - name: sysparm_group_by
          in: query
          required: false
          schema:
            type: string
          description: Field to group by (e.g., priority, category, assigned_to)
          example: "category"
        
        - name: sysparm_avg_fields
          in: query
          required: false
          schema:
            type: string
          description: Fields to calculate average
          example: "business_duration"
        
        - name: sysparm_sum_fields
          in: query
          required: false
          schema:
            type: string
          description: Fields to sum
          example: ""

      responses:
        '200':
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: array
                    items:
                      type: object
                      properties:
                        groupby_value:
                          type: string
                        count:
                          type: string
                        avg:
                          type: object
                        sum:
                          type: object
              example:
                result:
                  - groupby_value: "Email"
                    count: "45"
                  - groupby_value: "Network"
                    count: "32"
                  - groupby_value: "Hardware"
                    count: "18"
        
        '401':
          description: Unauthorized

components:
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
      description: Basic authentication using ServiceNow username and password

  schemas:
    Incident:
      type: object
      properties:
        sys_id:
          type: string
          description: Unique system identifier
          example: "abc123xyz789"
        
        number:
          type: string
          description: Incident number
          example: "INC0000001"
        
        short_description:
          type: string
          description: Brief summary
          example: "Email server not responding"
        
        description:
          type: string
          description: Detailed description
          example: "Users cannot access email. Server shows timeout errors."
        
        priority:
          type: string
          description: "Priority: 1=Critical, 2=High, 3=Moderate, 4=Low, 5=Planning"
          example: "2"
        
        urgency:
          type: string
          description: "Urgency: 1=High, 2=Medium, 3=Low"
          example: "1"
        
        impact:
          type: string
          description: "Impact: 1=High, 2=Medium, 3=Low"
          example: "2"
        
        state:
          type: string
          description: "State: 1=New, 2=In Progress, 3=On Hold, 6=Resolved, 7=Closed, 8=Canceled"
          example: "1"
        
        category:
          type: string
          description: Incident category
          example: "Email"
        
        subcategory:
          type: string
          description: Incident subcategory
          example: "Server"
        
        assigned_to:
          type: string
          description: Assigned user
          example: "John Doe"
        
        assignment_group:
          type: string
          description: Assignment group
          example: "IT Support"
        
        caller_id:
          type: string
          description: User who reported the incident
          example: "Jane Smith"
        
        sys_created_on:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2026-01-15 10:30:00"
        
        sys_updated_on:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2026-01-15 14:22:00"
        
        opened_at:
          type: string
          format: date-time
          description: When incident was opened
          example: "2026-01-15 10:30:00"
        
        resolved_at:
          type: string
          format: date-time
          description: Resolution timestamp
          example: "2026-01-15 16:45:00"
        
        closed_at:
          type: string
          format: date-time
          description: Closure timestamp
          example: "2026-01-16 09:00:00"
        
        work_notes:
          type: string
          description: Work notes (internal)
          example: "Investigating email server logs"
        
        close_notes:
          type: string
          description: Resolution notes
          example: "Issue resolved by restarting email service"
        
        business_duration:
          type: string
          description: Business hours duration
          example: "2 hours 30 minutes"
